# 05 问题与解决

## 已解决的问题

### 坐标错误
**问题**：棋子位置不正确  
**原因**：Y轴未反转  
**解决**：
```rust
// 修正Y轴计算
let board_y = (half_board - world_pos.y) / cell_size;
```

### Reset失效
**问题**：按R键棋子未清除  
**原因**：只重置状态，未清理实体  
**解决**：添加实体清理
```rust
for entity in stone_entities.iter() {
    commands.entity(entity).despawn();
}
```

### 棋子变形
**问题**：圆形显示为椭圆  
**原因**：Transform缩放问题  
**解决**：确保统一的aspect ratio

### 窗口切换错位
**问题**：切换屏幕后棋子错位  
**原因**：未重新计算位置  
**解决**：重绘时清理并重建所有棋子

### 中文乱码
**问题**：中文显示方块  
**临时方案**：使用英文  
**长期方案**：加载中文字体

## API变更适配

### Bevy 0.16
```rust
// 旧版本
get_single() → single()
send() → write()
```

## 调试技巧

### 日志输出
```rust
info!("落子位置: {:?}", position);
dbg!(&board_state);
```

### 可视化调试
```rust
// 添加调试标记
commands.spawn((
    Circle::new(5.0),
    Transform::from_xyz(x, y, 10.0),
));
```

## 性能瓶颈

### 问题定位
- 使用 `cargo flamegraph` 分析
- Bevy内置诊断插件

### 优化方案
- 减少不必要的重绘
- 批量处理实体
- 使用事件而非轮询